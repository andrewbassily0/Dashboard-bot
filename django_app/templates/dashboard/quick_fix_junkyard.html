{% extends 'dashboard/base.html' %}

{% block title %}ุฅุตูุงุญ ุณุฑูุน ููุชุดููุญ{% endblock %}

{% block page_title %}ุฅุตูุงุญ ุณุฑูุน ููุชุดููุญ{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Page Header -->
    <div class="glass-card p-6 rounded-xl animate-fade-up">
        <div class="flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center space-x-4 rtl:space-x-reverse">
                <div class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center text-white text-xl font-bold">
                    ๐ง
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100 mb-2">
                        ุฅุตูุงุญ ุณุฑูุน: {{ junkyard.user.first_name }}
                    </h1>
                    <p class="text-slate-600 dark:text-slate-400">
                        ุญู ูุดููุฉ "ุญุฏุซ ุฎุทุฃ" ุนูุฏ ุงูุถุบุท ุนูู "ุฅุถุงูุฉ ุนุฑุถ"
                    </p>
                </div>
            </div>
            <div class="flex items-center space-x-4 rtl:space-x-reverse">
                <a href="{% url 'dashboard:junkyard_detail' junkyard.id %}" class="btn-secondary">
                    <i class="fas fa-arrow-right mr-2"></i>
                    ุงูุนูุฏุฉ ููุชูุงุตูู
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Status -->
    <div class="glass-card rounded-xl p-6 animate-fade-up" style="animation-delay: 0.1s">
        <div class="flex items-center mb-4">
            <i class="fas fa-tachometer-alt text-primary-500 ml-2"></i>
            <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100">ุงูุญุงูุฉ ุงูุณุฑูุนุฉ</h3>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="text-center p-4 rounded-lg {% if junkyard.user.telegram_id %}bg-green-50 border-green-200{% else %}bg-red-50 border-red-200{% endif %} border">
                <div class="text-2xl mb-2">
                    {% if junkyard.user.telegram_id %}โ{% else %}โ{% endif %}
                </div>
                <div class="font-semibold text-sm">ูุนุฑู ุงูุชููุฌุฑุงู</div>
                <div class="text-xs text-slate-600">{{ junkyard.user.telegram_id|default:"ุบูุฑ ููุฌูุฏ" }}</div>
            </div>
            
            <div class="text-center p-4 rounded-lg {% if junkyard.user.user_type == 'junkyard' %}bg-green-50 border-green-200{% else %}bg-red-50 border-red-200{% endif %} border">
                <div class="text-2xl mb-2">
                    {% if junkyard.user.user_type == 'junkyard' %}โ{% else %}โ{% endif %}
                </div>
                <div class="font-semibold text-sm">ููุน ุงููุณุชุฎุฏู</div>
                <div class="text-xs text-slate-600">{{ junkyard.user.user_type }}</div>
            </div>
            
            <div class="text-center p-4 rounded-lg {% if junkyard.is_active %}bg-green-50 border-green-200{% else %}bg-red-50 border-red-200{% endif %} border">
                <div class="text-2xl mb-2">
                    {% if junkyard.is_active %}โ{% else %}โ{% endif %}
                </div>
                <div class="font-semibold text-sm">ุญุงูุฉ ุงูุชุดููุญ</div>
                <div class="text-xs text-slate-600">{% if junkyard.is_active %}ูููุนู{% else %}ุบูุฑ ูููุนู{% endif %}</div>
            </div>
            
            <div class="text-center p-4 rounded-lg {% if junkyard.city.is_active %}bg-green-50 border-green-200{% else %}bg-yellow-50 border-yellow-200{% endif %} border">
                <div class="text-2xl mb-2">
                    {% if junkyard.city.is_active %}โ{% else %}โ๏ธ{% endif %}
                </div>
                <div class="font-semibold text-sm">ุงููุฏููุฉ</div>
                <div class="text-xs text-slate-600">{{ junkyard.city.name }}</div>
            </div>
        </div>
    </div>

    <!-- Issues & Quick Fixes -->
    {% if issues %}
    <div class="glass-card rounded-xl p-6 animate-fade-up" style="animation-delay: 0.2s">
        <div class="flex items-center mb-6">
            <i class="fas fa-exclamation-triangle text-red-500 ml-2"></i>
            <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100">ูุดุงูู ุชุญุชุงุฌ ุฅุตูุงุญ</h3>
            <span class="badge-glass bg-red-100 text-red-600 border-red-200 mr-2">{{ issues|length }}</span>
        </div>
        
        <div class="space-y-4">
            {% for issue in issues %}
            <div class="{% if issue.type == 'critical' %}bg-red-50 border-red-200{% else %}bg-yellow-50 border-yellow-200{% endif %} border rounded-lg p-4">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <p class="font-medium {% if issue.type == 'critical' %}text-red-800{% else %}text-yellow-800{% endif %}">
                            {{ issue.message }}
                        </p>
                        {% if issue.fix and 'ูุฌุจ' in issue.fix %}
                        <p class="text-sm {% if issue.type == 'critical' %}text-red-600{% else %}text-yellow-600{% endif %} mt-1">
                            ๐ก {{ issue.fix }}
                        </p>
                        {% endif %}
                    </div>
                    {% if issue.fix and issue.fix_label %}
                    <form method="post" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="{{ issue.fix }}">
                        <button type="submit" class="btn-warning text-sm" 
                                onclick="return confirm('ูู ุชุฑูุฏ ุชุทุจูู ูุฐุง ุงูุฅุตูุงุญุ')">
                            {{ issue.fix_label }}
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div class="glass-card rounded-xl p-6 animate-fade-up" style="animation-delay: 0.3s">
        <div class="flex items-center mb-6">
            <i class="fas fa-bolt text-primary-500 ml-2"></i>
            <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100">ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ</h3>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% if can_test_telegram %}
            <form method="post" style="display: inline;">
                {% csrf_token %}
                <input type="hidden" name="action" value="test_telegram">
                <button type="submit" class="btn-primary w-full">
                    <i class="fas fa-paper-plane mr-2"></i>
                    ุงุฎุชุจุงุฑ ุงูุฑุณุงุฆู
                </button>
            </form>
            {% else %}
            <div class="btn-glass w-full opacity-50 cursor-not-allowed">
                <i class="fas fa-paper-plane mr-2"></i>
                ุงุฎุชุจุงุฑ ุงูุฑุณุงุฆู (ุบูุฑ ูุชุงุญ)
            </div>
            {% endif %}
            
            <a href="{% url 'dashboard:test_junkyard_notification' junkyard.id %}" class="btn-secondary w-full text-center">
                <i class="fas fa-bell mr-2"></i>
                ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช
            </a>
            
            <a href="{% url 'dashboard:edit_junkyard' junkyard.id %}" class="btn-secondary w-full text-center">
                <i class="fas fa-edit mr-2"></i>
                ุชุนุฏูู ุงูุจูุงูุงุช
            </a>
            
            <a href="{% url 'dashboard:diagnose_junkyard_issues' junkyard.id %}" class="btn-glass w-full text-center">
                <i class="fas fa-stethoscope mr-2"></i>
                ุชุดุฎูุต ููุตู
            </a>
        </div>
    </div>

    <!-- Activity Summary -->
    <div class="glass-card rounded-xl p-6 animate-fade-up" style="animation-delay: 0.4s">
        <div class="flex items-center mb-4">
            <i class="fas fa-chart-line text-primary-500 ml-2"></i>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">ููุฎุต ุงููุดุงุท</h3>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
            <div class="p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                <div class="text-2xl font-bold text-primary-600">{{ total_offers }}</div>
                <div class="text-sm text-slate-600 dark:text-slate-400">ุฅุฌูุงูู ุงูุนุฑูุถ</div>
            </div>
            
            <div class="p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                <div class="text-2xl font-bold text-green-600">{{ recent_offers }}</div>
                <div class="text-sm text-slate-600 dark:text-slate-400">ุนุฑูุถ ุงูุฃุณุจูุน ุงููุงุถู</div>
            </div>
            
            <div class="p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                <div class="text-2xl font-bold text-blue-600">{{ junkyard.city.name }}</div>
                <div class="text-sm text-slate-600 dark:text-slate-400">ุงููุฏููุฉ</div>
            </div>
        </div>
    </div>

    <!-- Step by Step Guide -->
    <div class="glass-card rounded-xl p-6 animate-fade-up" style="animation-delay: 0.5s">
        <div class="flex items-center mb-4">
            <i class="fas fa-list-ol text-primary-500 ml-2"></i>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">ุฏููู ุญู ุงููุดููุฉ ุฎุทูุฉ ุจุฎุทูุฉ</h3>
        </div>
        
        <div class="space-y-4">
            <div class="flex items-start space-x-3 rtl:space-x-reverse">
                <div class="bg-primary-100 text-primary-600 text-sm font-bold px-2 py-1 rounded-full mt-1">1</div>
                <div>
                    <h4 class="font-semibold text-slate-800 dark:text-slate-200">ุชุญูู ูู ุงููุดุงูู ุฃุนูุงู</h4>
                    <p class="text-sm text-slate-600 dark:text-slate-400">ุงุณุชุฎุฏู ุฃุฒุฑุงุฑ ุงูุฅุตูุงุญ ุงูุณุฑูุน ูุญู ุงููุดุงูู ุงูุญุฑุฌุฉ</p>
                </div>
            </div>
            
            <div class="flex items-start space-x-3 rtl:space-x-reverse">
                <div class="bg-primary-100 text-primary-600 text-sm font-bold px-2 py-1 rounded-full mt-1">2</div>
                <div>
                    <h4 class="font-semibold text-slate-800 dark:text-slate-200">ุงุฎุชุจุฑ ุงูุงุชุตุงู</h4>
                    <p class="text-sm text-slate-600 dark:text-slate-400">ุงุถุบุท "ุงุฎุชุจุงุฑ ุงูุฑุณุงุฆู" ููุชุฃูุฏ ูู ูุตูู ุงูุฑุณุงุฆู</p>
                </div>
            </div>
            
            <div class="flex items-start space-x-3 rtl:space-x-reverse">
                <div class="bg-primary-100 text-primary-600 text-sm font-bold px-2 py-1 rounded-full mt-1">3</div>
                <div>
                    <h4 class="font-semibold text-slate-800 dark:text-slate-200">ุฃุฎุจุฑ ุงูุชุดููุญ ุจุฅุฑุณุงู /start</h4>
                    <p class="text-sm text-slate-600 dark:text-slate-400">ุฅุฐุง ูุดู ุงูุงุฎุชุจุงุฑุ ูุฌุจ ุนูู ุงูุชุดููุญ ุฅุฑุณุงู /start ููุจูุช</p>
                </div>
            </div>
            
            <div class="flex items-start space-x-3 rtl:space-x-reverse">
                <div class="bg-primary-100 text-primary-600 text-sm font-bold px-2 py-1 rounded-full mt-1">4</div>
                <div>
                    <h4 class="font-semibold text-slate-800 dark:text-slate-200">ุงุฎุชุจุฑ ูุฑุฉ ุฃุฎุฑู</h4>
                    <p class="text-sm text-slate-600 dark:text-slate-400">ุฃุนุฏ ุงุฎุชุจุงุฑ ุงูุฑุณุงุฆู ูุงูุชุฃูุฏ ูู ุฃู "ุฅุถุงูุฉ ุนุฑุถ" ูุนูู</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Info -->
    <div class="glass-card rounded-xl p-6 animate-fade-up" style="animation-delay: 0.6s">
        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border-r-4 border-blue-500">
            <h4 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">๐ก ูุนูููุงุช ููุชูุงุตู ูุน ุงูุชุดููุญ:</h4>
            <div class="text-sm text-blue-700 dark:text-blue-300 space-y-1">
                <p><strong>ุงูุงุณู:</strong> {{ junkyard.user.first_name }} {{ junkyard.user.last_name }}</p>
                <p><strong>ุงููุงุชู:</strong> {{ junkyard.phone }}</p>
                {% if junkyard.user.telegram_username %}
                <p><strong>Telegram:</strong> @{{ junkyard.user.telegram_username }}</p>
                {% endif %}
                <p><strong>ุงููุฏููุฉ:</strong> {{ junkyard.city.name }}</p>
            </div>
        </div>
    </div>
</div>

<script>
// Auto refresh every 30 seconds
setTimeout(() => {
    window.location.reload();
}, 30000);

// Confirm actions
document.querySelectorAll('form[method="post"]').forEach(form => {
    form.addEventListener('submit', function(e) {
        const action = this.querySelector('input[name="action"]').value;
        if (action && !this.querySelector('button').onclick) {
            if (!confirm('ูู ุชุฑูุฏ ุชุทุจูู ูุฐุง ุงูุฅุฌุฑุงุกุ')) {
                e.preventDefault();
            }
        }
    });
});
</script>
{% endblock %}
