# n8n Workflows for Auto Parts Bot

ูุฐุง ุงููุฌูุฏ ูุญุชูู ุนูู workflows ุฌุงูุฒุฉ ูู n8n ูุงุณุชุฎุฏุงููุง ูุน ุจูุช ูุทุน ุบูุงุฑ ุงูุณูุงุฑุงุช.

## ๐ Workflows ุงููุชุงุญุฉ

### 1. New Request Workflow (`new_request_workflow.json`)
**ุงููุธููุฉ**: ูุนุงูุฌุฉ ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ูู ุงูุจูุช
**ุงููุฏุฎูุงุช**: Webhook ูู ุงูุจูุช
**ุงููุฎุฑุฌุงุช**: 
- ุฅูุดุงุก ุทูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุดุนุงุฑ ุงููุฎุงุฒู ูู ุงููุฏููุฉ
- ุชุฃููุฏ ููุนููู

**ุงูุฎุทูุงุช**:
1. ุงุณุชูุจุงู webhook ูู ุงูุจูุช
2. ุงูุชุญูู ูู ููุน ุงููุณุชุฎุฏู
3. ุฅูุดุงุก ุงูุทูุจ ุนุจุฑ Django API
4. ุงูุจุญุซ ุนู ุงููุฎุงุฒู ูู ุงููุฏููุฉ
5. ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูููุฎุงุฒู
6. ุชุฃููุฏ ููุนููู

### 2. New Offer Workflow (`new_offer_workflow.json`)
**ุงููุธููุฉ**: ูุนุงูุฌุฉ ุงูุนุฑูุถ ุงูุฌุฏูุฏุฉ ูู ุงููุฎุงุฒู
**ุงููุฏุฎูุงุช**: Webhook ูู ุงูุจูุช
**ุงููุฎุฑุฌุงุช**:
- ุฅูุดุงุก ุนุฑุถ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุดุนุงุฑ ุงูุนููู ุจุงูุนุฑุถ ุงูุฌุฏูุฏ

**ุงูุฎุทูุงุช**:
1. ุงุณุชูุจุงู webhook ูู ุงูุจูุช
2. ุฅูุดุงุก ุงูุนุฑุถ ุนุจุฑ Django API
3. ุงูุญุตูู ุนูู ุชูุงุตูู ุงูุทูุจ
4. ุฅุฑุณุงู ุฅุดุนุงุฑ ููุนููู

### 3. Scheduled Notifications Workflow (`scheduled_notifications.json`)
**ุงููุธููุฉ**: ุฅุดุนุงุฑุงุช ูุฌุฏููุฉ ููุทูุจุงุช ุงูุชู ุชูุชูู ูุฑูุจุงู
**ุงููุฏุฎูุงุช**: Cron trigger (ูู 6 ุณุงุนุงุช)
**ุงููุฎุฑุฌุงุช**:
- ุชูุจูู ุงูุนููุงุก ุจุงูุทูุจุงุช ุงูููุชููุฉ
- ุฅููุงููุฉ ุชูุฏูุฏ ุงูุทูุจุงุช

**ุงูุฎุทูุงุช**:
1. ุชุดุบูู ูู 6 ุณุงุนุงุช
2. ุงูุจุญุซ ุนู ุงูุทูุจุงุช ุงูุชู ุชูุชูู ุฎูุงู ุณุงุนุชูู
3. ุฅุฑุณุงู ุชูุจููุงุช ููุนููุงุก
4. ูุนุงูุฌุฉ ุทูุจุงุช ุงูุชูุฏูุฏ

## ๐ ููููุฉ ุงูุงุณุชูุฑุงุฏ

### ุงูุทุฑููุฉ ุงูุฃููู: ุงุณุชูุฑุงุฏ ูุฏูู
1. ุงูุชุญ n8n: `http://localhost:5678`
2. ุงุฐูุจ ุฅูู "Workflows" โ "Import from file"
3. ุงุฎุชุฑ ููู JSON ุงููุทููุจ
4. ุงุถุบุท "Import"

### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุงุณุชูุฑุงุฏ ุนุจุฑ API
```bash
# ุงุณุชูุฑุงุฏ workflow ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ
curl -X POST "http://localhost:5678/api/v1/workflows" \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic YWRtaW46YWRtaW4xMjM=" \
  -d @new_request_workflow.json

# ุงุณุชูุฑุงุฏ workflow ุงูุนุฑูุถ ุงูุฌุฏูุฏุฉ
curl -X POST "http://localhost:5678/api/v1/workflows" \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic YWRtaW46YWRtaW4xMjM=" \
  -d @new_offer_workflow.json

# ุงุณุชูุฑุงุฏ workflow ุงูุฅุดุนุงุฑุงุช ุงููุฌุฏููุฉ
curl -X POST "http://localhost:5678/api/v1/workflows" \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic YWRtaW46YWRtaW4xMjM=" \
  -d @scheduled_notifications.json
```

## โ๏ธ ุฅุนุฏุงุฏ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ

### ูู n8n
1. ุงุฐูุจ ุฅูู "Settings" โ "Variables"
2. ุฃุถู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ:

| ุงููุชุบูุฑ | ุงููููุฉ | ุงููุตู |
|---------|---------|---------|
| `TELEGRAM_BOT_TOKEN` | `7761835962:AAFoVhqWW3tU9podafzXVIxhF8t8BYoceYY` | Token ุงูุจูุช |
| `DJANGO_API_URL` | `http://django_app:8000` | ุฑุงุจุท Django API |
| `N8N_WEBHOOK_URL` | `http://localhost:5678` | ุฑุงุจุท n8n webhook |

### ูู Docker Compose
```yaml
environment:
  - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
  - DJANGO_API_URL=http://django_app:8000
  - N8N_WEBHOOK_URL=http://localhost:5678
```

## ๐ง ุงุฎุชุจุงุฑ Workflows

### 1. ุงุฎุชุจุงุฑ New Request Workflow
```bash
curl -X POST "http://localhost:5678/webhook/new-request" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 1,
    "user_telegram_id": 123456789,
    "city_id": 1,
    "brand_id": 1,
    "model_id": 1,
    "year": 2020,
    "parts": "ููุงุจุญ ุฃูุงููุฉ",
    "media_files": [],
    "request_type": "client"
  }'
```

### 2. ุงุฎุชุจุงุฑ New Offer Workflow
```bash
curl -X POST "http://localhost:5678/webhook/new-offer" \
  -H "Content-Type: application/json" \
  -d '{
    "request_id": 1,
    "junkyard_id": 1,
    "price": 500,
    "description": "ูุทุน ุฃุตููุฉ",
    "delivery_time": "3 ุฃูุงู"
  }'
```

## ๐ ูุฑุงูุจุฉ Workflows

### 1. ูุฑุงูุจุฉ ุงูุชูููุฐ
- ุงุฐูุจ ุฅูู "Executions" ูู n8n
- ุฑุงูุจ ูุฌุงุญ/ูุดู ูู workflow
- ุชุญูู ูู ุงูุณุฌูุงุช ููุฃุฎุทุงุก

### 2. ูุฑุงูุจุฉ Webhooks
- ุงุฐูุจ ุฅูู "Webhooks" ูู n8n
- ุชุญูู ูู ุญุงูุฉ ูู webhook
- ุงูุณุฎ URLs ููุงุณุชุฎุฏุงู ูู Django

### 3. ูุฑุงูุจุฉ Cron Jobs
- ุชุญูู ูู ุชุดุบูู Cron Trigger
- ุฑุงูุจ ุงูุฅุดุนุงุฑุงุช ุงููุฌุฏููุฉ
- ุชุญูู ูู ุชูููุช ุงูุชูููุฐ

## ๐๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ:

1. **Webhook ูุง ูุณุชุฌูุจ**:
   - ุชุญูู ูู ุชุดุบูู n8n
   - ุชุญูู ูู ุตุญุฉ URL
   - ุชุญูู ูู ุฅุนุฏุงุฏุงุช CORS

2. **ุฎุทุฃ ูู ุงูุงุชุตุงู ุจู Django**:
   - ุชุญูู ูู ุชุดุบูู Django
   - ุชุญูู ูู ุตุญุฉ API endpoints
   - ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูุดุจูุฉ

3. **ุฎุทุฃ ูู Telegram API**:
   - ุชุญูู ูู ุตุญุฉ Bot Token
   - ุชุญูู ูู ุตูุงุญูุงุช ุงูุจูุช
   - ุชุญูู ูู ูููุฏ API

### ุฃูุงูุฑ ูููุฏุฉ:
```bash
# ูุฑุงูุจุฉ ุณุฌูุงุช n8n
docker-compose logs n8n

# ูุฑุงูุจุฉ ุณุฌูุงุช Django
docker-compose logs django_app

# ุงุฎุชุจุงุฑ ุงุชุตุงู n8n
curl http://localhost:5678/healthz

# ุงุฎุชุจุงุฑ ุงุชุตุงู Django
curl http://localhost:8000/health/
```

## ๐ ุชุญุฏูุซ Workflows

### ุนูุฏ ุชุญุฏูุซ ุงูููุฏ:
1. ุชุตุฏูุฑ Workflows ุงูุญุงููุฉ
2. ุชุญุฏูุซ ูููุงุช JSON
3. ุงุณุชูุฑุงุฏ ุงููุณุฎ ุงููุญุฏุซุฉ
4. ุงุฎุชุจุงุฑ ุงููุธุงุฆู ุงูุฌุฏูุฏุฉ

### ูุณุฎ ุงุญุชูุงุทู:
```bash
# ุชุตุฏูุฑ ุฌููุน Workflows
curl -X GET "http://localhost:5678/api/v1/workflows" \
  -H "Authorization: Basic YWRtaW46YWRtaW4xMjM=" \
  > workflows_backup.json
```

## ๐ ุงูุฏุนู ุงูููู

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ:
1. ุฑุงุฌุน ุณุฌูุงุช n8n
2. ุฑุงุฌุน ุณุฌูุงุช Django
3. ุชุญูู ูู ุญุงูุฉ ุงูุฎุฏูุงุช
4. ุฑุงุฌุน ุฅุนุฏุงุฏุงุช ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ

---

**ููุงุญุธุฉ**: ุชุฃูุฏ ูู ุชุดุบูู ุฌููุน ุงูุฎุฏูุงุช ูุจู ุงุฎุชุจุงุฑ Workflows 